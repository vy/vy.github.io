<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="generator" content="Asciidoctor 1.5.4">
  <meta name="author" content="Volkan Yazıcı &lt;vy@apache.org&gt;">
  <title>JSON Template Layout</title>
  <link rel="stylesheet" href="https://asciidoclive.com/assets/asciidoctor.js/css/asciidoctor.css">
</head>

<body class="article">
  <div id="header">
    <h1>JSON Template Layout</h1>
    <div class="details">
      <span id="author" class="author">Volkan Yazıcı &lt;vy@apache.org&gt;</span><br>
    </div>
  </div>
  <div id="content">
    <div id="preamble">
      <div class="sectionbody">
        <div class="paragraph">
          <p><code>JsonTemplateLayout</code> is a customizable, efficient, and garbage-free
            JSON emitting layout. It encodes <code>LogEvent</code>s according to
            the structure described by the JSON template provided. In a nutshell,
            it shines with its</p>
        </div>
        <div class="ulist">
          <ul>
            <li>
              <p>Customizable JSON structure (see <code>eventTemplate[Uri]</code> and
                <code>stackTraceElementTemplate[Uri]</code> parameters)</p>
            </li>
            <li>
              <p>Customizable timestamp formatting (see <code>timestamp</code> parameter)</p>
            </li>
          </ul>
        </div>
      </div>
    </div>
    <div class="sect1">
      <h2 id="usage">Usage</h2>
      <div class="sectionbody">
        <div class="paragraph">
          <p>Adding <code>log4j-layout-json-template</code> artifact to your list of
            dependencies is enough to enable access to <code>JsonTemplateLayout</code>            in your Log4j configuration:</p>
        </div>
        <div class="listingblock">
          <div class="content">
            <pre class="highlight"><code class="language-xml" data-lang="xml">&lt;dependency&gt;
    &lt;groupId&gt;org.apache.logging.log4j&lt;/groupId&gt;
    &lt;artifactId&gt;log4j-layout-json-template&lt;/artifactId&gt;
    &lt;version&gt;${log4j.version}&lt;/version&gt;
&lt;/dependency&gt;</code></pre>
          </div>
        </div>
        <div class="paragraph">
          <p>For instance, given the following JSON template modelling the
            <a href="https://github.com/logstash/log4j-jsonevent-layout">the official Logstash
<code>JSONEventLayoutV1</code></a> (accessible via <code>classpath:LogstashJsonEventLayoutV1.json</code>)</p>
        </div>
        <div class="listingblock">
          <div class="content">
            <pre class="highlight"><code class="language-json" data-lang="json">{
  "mdc": {
    "$resolver": "mdc"
  },
  "exception": {
    "exception_class": {
      "$resolver": "exception",
      "field": "className"
    },
    "exception_message": {
      "$resolver": "exception",
      "field": "message",
      "stringified": true
    },
    "stacktrace": {
      "$resolver": "exception",
      "field": "stackTrace",
      "stringified": true
    }
  },
  "line_number": {
    "$resolver": "source",
    "field": "lineNumber"
  },
  "class": {
    "$resolver": "source",
    "field": "className"
  },
  "@version": 1,
  "source_host": "${hostName}",
  "message": {
    "$resolver": "message",
    "stringified": true
  },
  "thread_name": {
    "$resolver": "thread",
    "field": "name"
  },
  "@timestamp": {
    "$resolver": "timestamp"
  },
  "level": {
    "$resolver": "level",
    "field": "name"
  },
  "file": {
    "$resolver": "source",
    "field": "fileName"
  },
  "method": {
    "$resolver": "source",
    "field": "methodName"
  },
  "logger_name": {
    "$resolver": "logger",
    "field": "name"
  }
}</code></pre>
          </div>
        </div>
        <div class="paragraph">
          <p>in combination with the below <code>log4j2.xml</code> configuration:</p>
        </div>
        <div class="listingblock">
          <div class="content">
            <pre class="highlight"><code class="language-xml" data-lang="xml">&lt;JsonTemplateLayout eventTemplateUri="classpath:LogstashJsonEventLayoutV1.json"/&gt;</code></pre>
          </div>
        </div>
        <div class="paragraph">
          <p>or with the below <code>log4j2.properties</code> configuration:</p>
        </div>
        <div class="listingblock">
          <div class="content">
            <pre class="highlight"><code class="language-ini" data-lang="ini">appender.console.json.type = JsonTemplateLayout
appender.console.json.eventTemplateUri = classpath:LogstashJsonEventLayoutV1.json</code></pre>
          </div>
        </div>
        <div class="paragraph">
          <p><code>JsonTemplateLayout</code> emits JSON strings as follows:</p>
        </div>
        <div class="listingblock">
          <div class="content">
            <pre class="highlight"><code class="language-json" data-lang="json">{
  "exception": {
    "exception_class": "java.lang.RuntimeException",
    "exception_message": "test",
    "stacktrace": "java.lang.RuntimeException: test\n\tat org.apache.logging.log4j.JsonTemplateLayoutDemo.main(JsonTemplateLayoutDemo.java:11)\n"
  },
  "line_number": 12,
  "class": "org.apache.logging.log4j.JsonTemplateLayoutDemo",
  "@version": 1,
  "source_host": "varlik",
  "message": "Hello, error!",
  "thread_name": "main",
  "@timestamp": "2017-05-25T19:56:23.370+02:00",
  "level": "ERROR",
  "file": "JsonTemplateLayoutDemo.java",
  "method": "main",
  "logger_name": "org.apache.logging.log4j.JsonTemplateLayoutDemo"
}</code></pre>
          </div>
        </div>
      </div>
    </div>
    <div class="sect1">
      <h2 id="layout-config">Layout Configuration</h2>
      <div class="sectionbody">
        <div class="paragraph">
          <p><code>JsonTemplateLayout</code> is configured with the following parameters:</p>
        </div>
        <table class="tableblock frame-all grid-all spread">
          <caption class="title">Table 1. <code>JsonTemplateLayout</code> parameters</caption>
          <colgroup>
            <col style="width: 16.6666%;">
            <col style="width: 16.6666%;">
            <col style="width: 66.6668%;">
          </colgroup>
          <tbody>
            <tr>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock"><code>Parameter Name</code></p>
              </td>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock"><code>Type</code></p>
              </td>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock">Description</p>
              </td>
            </tr>
            <tr>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock"><code>charset</code></p>
              </td>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock"><code>Charset</code></p>
              </td>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock"><code>Charset</code> used for <code>String</code> encoding</p>
              </td>
            </tr>
            <tr>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock"><code>locationInfoEnabled</code></p>
              </td>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock"><code>boolean</code></p>
              </td>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock">toggles access to the <code>LogEvent</code> source; file name, line
                  number, etc. (defaults to <code>false</code> set by <code>log4j.layout.jsonTemplate.locationInfoEnabled</code>                  property)
                </p>
              </td>
            </tr>
            <tr>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock"><code>stackTraceEnabled</code></p>
              </td>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock"><code>boolean</code></p>
              </td>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock">toggles access to the stack traces (defaults to <code>true</code>                  set by
                  <code>log4j.layout.jsonTemplate.stackTraceEnabled</code> property)</p>
              </td>
            </tr>
            <tr>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock"><code>eventTemplate</code></p>
              </td>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock"><code>String</code></p>
              </td>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock">inline JSON template for rendering <code>LogEvent</code>s (has priority
                  over
                  <code>eventTemplateUri</code>, defaults to <code>null</code> set
                  by
                  <code>log4j.layout.jsonTemplate.eventTemplate</code> property)</p>
              </td>
            </tr>
            <tr>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock"><code>eventTemplateUri</code></p>
              </td>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock"><code>String</code></p>
              </td>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock">URI pointing to the JSON template for rendering <code>LogEvent</code>s
                  (defaults to
                  <code>classpath:EcsLayout.json</code> set by <code>log4j.layout.jsonTemplate.eventTemplateUri</code>                  property)
                </p>
              </td>
            </tr>
            <tr>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock"><code>eventTemplateAdditionalFields</code></p>
              </td>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock"><code>KeyValuePair[]</code></p>
              </td>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock">additional key-value pairs appended to the root of the event template</p>
              </td>
            </tr>
            <tr>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock"><code>stackTraceElementTemplate</code></p>
              </td>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock"><code>String</code></p>
              </td>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock">inline JSON template for rendering <code>StackTraceElement</code>s
                  (has priority over
                  <code>stackTraceElementTemplateUri</code>, defaults to <code>null</code>                  set by
                  <code>log4j.layout.jsonTemplate.stackTraceElementTemplate</code>                  property)</p>
              </td>
            </tr>
            <tr>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock"><code>stackTraceElementTemplateUri</code></p>
              </td>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock"><code>String</code></p>
              </td>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock">JSON template for rendering <code>StackTraceElement</code>s (defaults
                  to
                  <code>classpath:StackTraceElementLayout.json</code> set by
                  <code>log4j.layout.jsonTemplate.stackTraceElementTemplateUri</code>                  property)</p>
              </td>
            </tr>
            <tr>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock"><code>eventDelimiter</code></p>
              </td>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock"><code>String</code></p>
              </td>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock">delimiter used for separating emitted <code>LogEvent</code>s (defaults
                  to
                  <code>System.lineSeparator()</code> set by <code>log4j.layout.jsonTemplate.eventDelimiter</code>                  property)
                </p>
              </td>
            </tr>
            <tr>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock"><code>maxStringLength</code></p>
              </td>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock"><code>int</code></p>
              </td>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock">truncate string values longer than the specified limit (defaults
                  to 16384 set by <code>log4j.layout.jsonTemplate.maxStringLength</code>                  property)</p>
              </td>
            </tr>
            <tr>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock"><code>truncatedStringSuffix</code></p>
              </td>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock"><code>String</code></p>
              </td>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock">suffix to append to strings truncated due to exceeding <code>maxStringLength</code>                  (defaults to <code>…</code> set by <code>log4j.layout.jsonTemplate.truncatedStringSuffix</code>                  property)
                </p>
              </td>
            </tr>
            <tr>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock"><code>recyclerFactory</code></p>
              </td>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock"><code>RecyclerFactory</code></p>
              </td>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock">recycling strategy that can either be <code>dummy</code>, <code>threadLocal</code>,
                  or <code>queue</code> (set by <code>log4j.layout.jsonTemplate.recyclerFactory</code>                  property)</p>
              </td>
            </tr>
          </tbody>
        </table>
        <div class="sect2">
          <h3 id="additional-event-template-fields">Additonal event template fields</h3>
          <div class="paragraph">
            <p>One can configure additional event template fields via
              <code>eventTemplateAdditionalFields</code> as follows:</p>
          </div>
          <div class="listingblock">
            <div class="content">
              <pre class="highlight"><code class="language-xml" data-lang="xml">&lt;JsonTemplateLayout ...&gt;
    &lt;EventTemplateAdditionalFields&gt;
        &lt;EventTemplateAdditionalField key="serviceName" value="auth-service"/&gt;
        &lt;EventTemplateAdditionalField key="containerId" value="6ede3f0ca7d9"/&gt;
    &lt;/EventTemplateAdditionalFields&gt;
&lt;/JsonTemplateLayout&gt;</code></pre>
            </div>
          </div>
          <div class="paragraph">
            <p>One can also pass JSON literals into additional fields:</p>
          </div>
          <div class="listingblock">
            <div class="content">
              <pre class="highlight"><code class="language-xml" data-lang="xml">&lt;EventTemplateAdditionalField
     key="marker"
     type="JSON"
     value='{"$resolver": "marker", "field": "name"}'/&gt;
&lt;EventTemplateAdditionalField
     key="aNumber"
     type="JSON"
     value="1"/&gt;
&lt;EventTemplateAdditionalField
     key="aList"
     type="JSON"
     value='[1,2,"string"]'/&gt;</code></pre>
            </div>
          </div>
        </div>
        <div class="sect2">
          <h3 id="recycling-strategy">Recycling strategy</h3>
          <div class="paragraph">
            <p><code>RecyclerFactory</code> plays a crucial role for determining the
              memory footprint of the layout. Template resolvers employ it to create
              recyclers for objects that they can reuse. The function of each <code>RecyclerFactory</code>              and when one should prefer one over another is explained below:</p>
          </div>
          <div class="ulist">
            <ul>
              <li>
                <p><code>dummy</code> performs no recycling, hence each recycling attempt
                  will result in a new instance. This will obviously create a load
                  on the garbage-collector. It is a good choice for applications
                  with low and medium log rate.</p>
              </li>
              <li>
                <p><code>threadLocal</code> performs the best, since every instance
                  is stored in TLAB and accessed without any synchronization cost.
                  Though this might not be a desirable option for applications running
                  with hundreds of threads or more, e.g., a web servlet.</p>
              </li>
              <li>
                <p><code>queue</code> is the best of both worlds. It allows recycling
                  of objects up to a certain number (<code>capacity</code>). When
                  this limit is exceeded due to excessive concurrent load (e.g.,
                  <code>capacity</code> is 50 but there are 51 threads concurrently
                  trying to log), it starts allocating. <code>queue</code> is a good
                  strategy where
                  <code>threadLocal</code> is not desirable.</p>
                <div class="paragraph">
                  <p><code>queue</code> also accepts optional <code>supplier</code>                    (of type <code>java.util.Queue</code>, defaults to
                    <code>org.jctools.queues.MpmcArrayQueue.new</code> if JCTools
                    is in the classpath; otherwise <code>java.util.concurrent.ArrayBlockingQueue.new</code>)
                    and <code>capacity</code> (of type <code>int</code>, defaults
                    to <code>max(8,2*cpuCount+1)</code>) parameters:</p>
                </div>
                <div class="listingblock">
                  <div class="content">
                    <pre class="highlight"><code>queue:supplier=org.jctools.queues.MpmcArrayQueue.new
queue:capacity=10
queue:supplier=java.util.concurrent.ArrayBlockingQueue.new,capacity=50</code></pre>
                  </div>
                </div>
              </li>
            </ul>
          </div>
          <div class="paragraph">
            <p>The default <code>RecyclerFactory</code> is <code>threadLocal</code>,
              if
              <code>log4j2.enable.threadlocals=true</code>; otherwise, <code>queue</code>.</p>
          </div>
        </div>
      </div>
    </div>
    <div class="sect1">
      <h2 id="template-config">Template Configuration</h2>
      <div class="sectionbody">
        <div class="paragraph">
          <p>Templates are configured by means of the following <code>JsonTemplateLayout</code>            parameters:
          </p>
        </div>
        <div class="ulist">
          <ul>
            <li>
              <p><code>eventTemplate[Uri]</code> (for serializing <code>LogEvent</code>s)</p>
            </li>
            <li>
              <p><code>stackTraceElementTemplate[Uri]</code> (for serializing <code>StackStraceElement</code>s)</p>
            </li>
            <li>
              <p><code>eventTemplateAdditionalFields</code> (for extending the used
                event template)</p>
            </li>
          </ul>
        </div>
        <div class="sect2">
          <h3 id="event-templates">Event Templates</h3>
          <div class="paragraph">
            <p><code>eventTemplate[Uri]</code> describes the JSON structure <code>JsonTemplateLayout</code>              uses to serialize <code>LogEvent</code>s. The default configuration
              (accessible by
              <code>log4j.layout.jsonTemplate.eventTemplate[Uri]</code> property)
              is set to
              <code>classpath:EcsLayout.json</code> provided by the <code>log4j-layout-json-template</code>              artifact:
            </p>
          </div>
          <div class="listingblock">
            <div class="content">
              <pre class="highlight"><code class="language-json" data-lang="json">{
  "@timestamp": {
    "$resolver": "timestamp",
    "pattern": {
      "format": "yyyy-MM-dd'T'HH:mm:ss.SSS'Z'",
      "timeZone": "UTC"
    }
  },
  "log.level": {
    "$resolver": "level",
    "field": "name"
  },
  "message": {
    "$resolver": "message",
    "stringified": true
  },
  "process.thread.name": {
    "$resolver": "thread",
    "field": "name"
  },
  "log.logger": {
    "$resolver": "logger",
    "field": "name"
  },
  "labels": {
    "$resolver": "mdc",
    "flatten": {
      "prefix": "labels."
    },
    "stringified": true
  },
  "tags": {
    "$resolver": "ndc"
  },
  "error.type": {
    "$resolver": "exception",
    "field": "className"
  },
  "error.message": {
    "$resolver": "exception",
    "field": "message"
  },
  "error.stack_trace": {
    "$resolver": "exception",
    "field": "stackTrace",
    "stringified": true
  }
}</code></pre>
            </div>
          </div>
          <div class="paragraph">
            <p><code>log4j-layout-json-template</code> artifact contains the following
              predefined event templates:
            </p>
          </div>
          <div class="ulist">
            <ul>
              <li>
                <p><a href="https://github.com/apache/logging-log4j2/tree/master/log4j-layout-json-template/src/main/resources/EcsLayout.json"><code>EcsLayout.json</code></a>                  described by <a href="https://www.elastic.co/guide/en/ecs/current/ecs-reference.html">the Elastic Common Schema (ECS) specification</a></p>
              </li>
              <li>
                <p><a href="https://github.com/apache/logging-log4j2/tree/master/log4j-layout-json-template/src/main/resources/LogstashJsonEventLayoutV1.json"><code>LogstashJsonEventLayoutV1.json</code></a>                  described in <a href="https://github.com/logstash/log4j-jsonevent-layout">Logstash
<code>json_event</code> pattern for log4j</a></p>
              </li>
              <li>
                <p><a href="https://github.com/apache/logging-log4j2/tree/master/log4j-layout-json-template/src/main/resources/GelfLayout.json"><code>GelfLayout.json</code></a>                  described by <a href="https://docs.graylog.org/en/3.1/pages/gelf.html#gelf-payload-specification">the
Graylog Extended Log Format (GELF) payload specification</a> with additional
                  <code>_thread</code> and <code>_logger</code> fields. (Here it
                  is advised to override the obligatory
                  <code>host</code> field with a user provided constant via <code>eventTemplateAdditionalFields</code>                  to avoid <code>hostName</code> property lookup at runtime, which
                  incurs an extra cost.)</p>
              </li>
              <li>
                <p><a href="https://github.com/apache/logging-log4j2/tree/master/log4j-layout-json-template/src/main/resources/JsonLayout.json"><code>JsonLayout.json</code></a>                  providing the exact JSON structure generated by <a href="layouts.html#JSONLayout"><code>JsonLayout</code></a>                  with the exception of <code>thrown</code> field. (<code>JsonLayout</code>                  serializes the <code>Throwable</code> as is via Jackson <code>ObjectMapper</code>,
                  whereas <code>JsonLayout.json</code> template of
                  <code>JsonTemplateLayout</code> employs the <code>StackTraceElementLayout.json</code>                  template for stack traces to generate a document-store-friendly
                  flat structure.)</p>
              </li>
            </ul>
          </div>
          <div class="paragraph">
            <p>Below is the list of supported event template resolvers:</p>
          </div>
          <table id="event-template-resolvers" class="tableblock frame-all grid-all spread">
            <caption class="title">Table 2. <code>LogEvent</code> template resolvers</caption>
            <colgroup>
              <col style="width: 8.3333%;">
              <col style="width: 25%;">
              <col style="width: 16.6666%;">
              <col style="width: 16.6666%;">
              <col style="width: 33.3335%;">
            </colgroup>
            <tbody>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock"><code>Resolver Name</code></p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">Syntax</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">Description</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">Garbage Footprint</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">Examples</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock"><code>endOfBatch</code></p>
                </td>
                <td class="tableblock halign-left valign-top"></td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock"><code>logEvent.isEndOfBatch()</code></p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">none</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <div>
                    <div class="listingblock">
                      <div class="content">
                        <pre class="highlight"><code class="language-json" data-lang="json">{
  "$resolver": "endOfBatch"
}</code></pre>
                      </div>
                    </div>
                  </div>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock"><code>exception</code></p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <div>
                    <div class="listingblock">
                      <div class="content">
                        <pre class="highlight"><code>config      = field , [ stringified ]
field       = "field" -&gt; (
                "className"  |
                "message"    |
                "stackTrace" )
stringified = "stringified" -&gt; boolean</code></pre>
                      </div>
                    </div>
                  </div>
                </td>
                <td class="tableblock halign-left valign-top">
                  <div>
                    <div class="paragraph">
                      <p>Resolves fields of the <code>Throwable</code> returned by <code>logEvent.getThrown()</code>.</p>
                    </div>
                    <div class="paragraph">
                      <p>Note that this resolver is toggled by
                        <code>log4j.layout.jsonTemplate.stackTraceEnabled</code>                        property.</p>
                    </div>
                  </div>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">Since <code>Throwable#getStackTrace()</code> clones the original
                    <code>StackTraceElement[]</code>, access to (and hence rendering
                    of) stack traces are not garbage-free.</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <div>
                    <div class="paragraph">
                      <p>Resolve <code>logEvent.getThrown().getClass().getCanonicalName()</code>:</p>
                    </div>
                    <div class="listingblock">
                      <div class="content">
                        <pre class="highlight"><code class="language-json" data-lang="json">{
  "$resolver": "exception",
  "field": "className"
}</code></pre>
                      </div>
                    </div>
                    <div class="paragraph">
                      <p>Resolve the stack trace into a list of <code>StackTraceElement</code>                        objects:</p>
                    </div>
                    <div class="listingblock">
                      <div class="content">
                        <pre class="highlight"><code class="language-json" data-lang="json">{
  "$resolver": "exception",
  "field": "stackTrace"
}</code></pre>
                      </div>
                    </div>
                    <div class="paragraph">
                      <p>Resolve the stack trace into a string field:</p>
                    </div>
                    <div class="listingblock">
                      <div class="content">
                        <pre class="highlight"><code class="language-json" data-lang="json">{
  "$resolver": "exception",
  "field": "stackTrace",
  "stringified": true
}</code></pre>
                      </div>
                    </div>
                  </div>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock"><code>exceptionRootCause</code></p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">identical to <code>exception</code> resolver</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <div>
                    <div class="paragraph">
                      <p>Resolves the fields of the innermost <code>Throwable</code>                        returned by
                        <code>logEvent.getThrown()</code>.</p>
                    </div>
                    <div class="paragraph">
                      <p>Note that this resolver is toggled by
                        <code>log4j.layout.jsonTemplate.stackTraceEnabled</code>                        property.</p>
                    </div>
                  </div>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">identical to <code>exception</code> resolver</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">identical to <code>exception</code> resolver</p>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock"><code>level</code></p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <div>
                    <div class="listingblock">
                      <div class="content">
                        <pre class="highlight"><code>config         = field , [ severity ]
field          = "field" -&gt; ( "name" | "severity" )
severity       = severity-field
severity-field = "field" -&gt; ( "keyword" | "code" )</code></pre>
                      </div>
                    </div>
                  </div>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">resolves the fields of the <code>logEvent.getLevel()</code></p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">none</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <div>
                    <div class="paragraph">
                      <p>Resolve the level name:</p>
                    </div>
                    <div class="listingblock">
                      <div class="content">
                        <pre class="highlight"><code class="language-json" data-lang="json">{
  "$resolver": "level",
  "field": "name"
}</code></pre>
                      </div>
                    </div>
                    <div class="paragraph">
                      <p>Resolve the <a href="https://en.wikipedia.org/wiki/Syslog#Severity_levels">Syslog severity</a>                        keyword:
                      </p>
                    </div>
                    <div class="listingblock">
                      <div class="content">
                        <pre class="highlight"><code class="language-json" data-lang="json">{
  "$resolver": "level",
  "field": "severity",
  "severity": {
    "field": "keyword"
  }
}</code></pre>
                      </div>
                    </div>
                    <div class="paragraph">
                      <p>Resolve the <a href="https://en.wikipedia.org/wiki/Syslog#Severity_levels">Syslog severity</a>                        code:
                      </p>
                    </div>
                    <div class="listingblock">
                      <div class="content">
                        <pre class="highlight"><code class="language-json" data-lang="json">{
  "$resolver": "level",
  "field": "severity",
  "severity": {
    "field": "code"
  }
}</code></pre>
                      </div>
                    </div>
                  </div>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock"><code>logger</code></p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <div>
                    <div class="listingblock">
                      <div class="content">
                        <pre class="highlight"><code>config = "field" -&gt; ( "name" | "fqcn" )</code></pre>
                      </div>
                    </div>
                  </div>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">resolves <code>logEvent.getLoggerFqcn()</code> and <code>logEvent.getLoggerName()</code></p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">none</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <div>
                    <div class="paragraph">
                      <p>Resolve the logger name:</p>
                    </div>
                    <div class="listingblock">
                      <div class="content">
                        <pre class="highlight"><code class="language-json" data-lang="json">{
  "$resolver": "logger",
  "field": "name"
}</code></pre>
                      </div>
                    </div>
                    <div class="paragraph">
                      <p>Resolve the logger&#8217;s fully qualified class name:</p>
                    </div>
                    <div class="listingblock">
                      <div class="content">
                        <pre class="highlight"><code class="language-json" data-lang="json">{
  "$resolver": "logger",
  "field": "fqcn"
}</code></pre>
                      </div>
                    </div>
                  </div>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock"><code>main:&lt;key&gt;</code></p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <div>
                    <div class="listingblock">
                      <div class="content">
                        <pre class="highlight"><code>config = ( index | key )
index  = "index" -&gt; number
key    = "key" -&gt; string</code></pre>
                      </div>
                    </div>
                  </div>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">performs <a href="lookups.html#AppMainArgsLookup">Main Argument Lookup</a>                    for the given <code>index</code> or <code>key</code></p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">none</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <div>
                    <div class="paragraph">
                      <p>Resolve the 1st <code>main()</code> method argument:</p>
                    </div>
                    <div class="listingblock">
                      <div class="content">
                        <pre class="highlight"><code class="language-json" data-lang="json">{
  "$resolver": "main",
  "index": 0
}</code></pre>
                      </div>
                    </div>
                    <div class="paragraph">
                      <p>Resolve the argument coming right after <code>--userId</code>:</p>
                    </div>
                    <div class="listingblock">
                      <div class="content">
                        <pre class="highlight"><code class="language-json" data-lang="json">{
  "$resolver": "main",
  "key": "--userId"
}</code></pre>
                      </div>
                    </div>
                  </div>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock"><code>map</code></p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <div>
                    <div class="listingblock">
                      <div class="content">
                        <pre class="highlight"><code>config = "key" -&gt; string</code></pre>
                      </div>
                    </div>
                  </div>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">performs <a href="lookups.html#MapLookup">Map Lookup</a> for the
                    given <code>key</code></p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">none</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <div>
                    <div class="paragraph">
                      <p>Resolve the <code>userRole</code> field of the message:</p>
                    </div>
                    <div class="listingblock">
                      <div class="content">
                        <pre class="highlight"><code class="language-json" data-lang="json">{
  "$resolver": "map",
  "key": "userRole"
}</code></pre>
                      </div>
                    </div>
                  </div>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock"><code>marker</code></p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <div>
                    <div class="listingblock">
                      <div class="content">
                        <pre class="highlight"><code>config = "field" -&gt; "name"</code></pre>
                      </div>
                    </div>
                  </div>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock"><code>logEvent.getMarker().getName()</code></p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">none</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <div>
                    <div class="paragraph">
                      <p>Resolve the marker name:</p>
                    </div>
                    <div class="listingblock">
                      <div class="content">
                        <pre class="highlight"><code class="language-json" data-lang="json">{
  "$resolver": "marker",
  "field": "name"
}</code></pre>
                      </div>
                    </div>
                  </div>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock"><code>mdc</code></p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <div>
                    <div class="listingblock">
                      <div class="content">
                        <pre class="highlight"><code>config        = singleAccess | multiAccess

singleAccess  = key , [ stringified ]
key           = "key" -&gt; string
stringified   = "stringified" -&gt; boolean

multi-access  = [ pattern ] , [ flatten ] , [ stringified ]
pattern       = "pattern" -&gt; string
flatten       = "flatten" -&gt; ( boolean | flattenConfig )
flattenConfig = [ flattenPrefix ]
flattenPrefix = "prefix" -&gt; string</code></pre>
                      </div>
                    </div>
                  </div>
                </td>
                <td class="tableblock halign-left valign-top">
                  <div>
                    <div class="paragraph">
                      <p>Mapped Diagnostic Context (MDC), aka. Thread Context Data,
                        resolver.</p>
                    </div>
                    <div class="paragraph">
                      <p><code>singleAccess</code> resolves the MDC value as is, whilst
                        <code>multiAccess</code> resolves a multitude of MDC values.
                        If <code>flatten</code> is provided, <code>multiAccess</code>                        merges the values with the parent, otherwise creates a new
                        JSON object containing the values.
                      </p>
                    </div>
                    <div class="paragraph">
                      <p>Enabling <code>stringified</code> flag converts each value
                        to its string representation.</p>
                    </div>
                    <div class="paragraph">
                      <p>Regex provided in the <code>pattern</code> is used to match
                        against the keys.</p>
                    </div>
                  </div>
                </td>
                <td class="tableblock halign-left valign-top">
                  <div>
                    <div class="paragraph">
                      <p><code>log4j2.garbagefreeThreadContextMap</code> flag needs
                        to be turned on to iterate the map without allocations.</p>
                    </div>
                    <div class="paragraph">
                      <p><code>stringify</code> allocates a new <code>String</code>                        for values that are not of type <code>String</code>.</p>
                    </div>
                    <div class="paragraph">
                      <p>Writing certain non-primitive values (e.g., <code>BigDecimal</code>,
                        <code>Set</code>, etc.) to JSON generates garbage, though
                        most (e.g., <code>int</code>, <code>long</code>, <code>String</code>,
                        <code>List</code>,
                        <code>boolean[]</code>, etc.) don&#8217;t.</p>
                    </div>
                  </div>
                </td>
                <td class="tableblock halign-left valign-top">
                  <div>
                    <div class="paragraph">
                      <p>Resolve the <code>userRole</code> MDC value:</p>
                    </div>
                    <div class="listingblock">
                      <div class="content">
                        <pre class="highlight"><code class="language-json" data-lang="json">{
  "$resolver": "mdc",
  "key": "userRole"
}</code></pre>
                      </div>
                    </div>
                    <div class="paragraph">
                      <p>Resolve the string representation of the <code>userRank</code>                        MDC value:</p>
                    </div>
                    <div class="listingblock">
                      <div class="content">
                        <pre class="highlight"><code class="language-json" data-lang="json">{
  "$resolver": "mdc",
  "key": "userRank",
  "stringified": true
}</code></pre>
                      </div>
                    </div>
                    <div class="paragraph">
                      <p>Resolve all MDC entries into an object:</p>
                    </div>
                    <div class="listingblock">
                      <div class="content">
                        <pre class="highlight"><code class="language-json" data-lang="json">{
  "$resolver": "mdc"
}</code></pre>
                      </div>
                    </div>
                    <div class="paragraph">
                      <p>Resolve all MDC entries into an object such that values are
                        converted to string:</p>
                    </div>
                    <div class="listingblock">
                      <div class="content">
                        <pre class="highlight"><code class="language-json" data-lang="json">{
  "$resolver": "mdc",
  "stringified": true
}</code></pre>
                      </div>
                    </div>
                    <div class="paragraph">
                      <p>Merge all MDC entries whose keys are matching with the <code>user(Role|Rank)</code>                        regex into the parent:</p>
                    </div>
                    <div class="listingblock">
                      <div class="content">
                        <pre class="highlight"><code class="language-json" data-lang="json">{
  "$resolver": "mdc",
  "flatten": true,
  "pattern": "user(Role|Rank)"
}</code></pre>
                      </div>
                    </div>
                    <div class="paragraph">
                      <p>After converting the corresponding entries to string, merge
                        all MDC entries to parent such that keys are prefixed with
                        <code>_</code>:</p>
                    </div>
                    <div class="listingblock">
                      <div class="content">
                        <pre class="highlight"><code class="language-json" data-lang="json">{
  "$resolver": "mdc",
  "stringified": true,
  "flatten": {
    "prefix": "_"
  }
}</code></pre>
                      </div>
                    </div>
                  </div>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock"><code>message</code></p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <div>
                    <div class="listingblock">
                      <div class="content">
                        <pre class="highlight"><code>config      = [ stringified ]
stringified = "stringified" -&gt; boolean</code></pre>
                      </div>
                    </div>
                  </div>
                </td>
                <td class="tableblock halign-left valign-top">
                  <div>
                    <div class="paragraph">
                      <p><code>logEvent.getMessage()</code></p>
                    </div>
                  </div>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">For simple string messages, the resolution is performed without
                    allocations. For <code>ObjectMessage</code>s and <code>MultiformatMessage</code>s,
                    it depends.</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <div>
                    <div class="paragraph">
                      <p>Resolve the message into a string:</p>
                    </div>
                    <div class="listingblock">
                      <div class="content">
                        <pre class="highlight"><code class="language-json" data-lang="json">{
  "$resolver": "message",
  "stringified": true
}</code></pre>
                      </div>
                    </div>
                    <div class="paragraph">
                      <p>Resolve the message such that if it is an <code>ObjectMessage</code>                        or a
                        <code>MultiformatMessage</code> with JSON support, its type
                        (string, list, object, etc.) will be retained:</p>
                    </div>
                    <div class="listingblock">
                      <div class="content">
                        <pre class="highlight"><code class="language-json" data-lang="json">{
  "$resolver": "message"
}</code></pre>
                      </div>
                    </div>
                  </div>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock"><code>ndc</code></p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <div>
                    <div class="listingblock">
                      <div class="content">
                        <pre class="highlight"><code>config  = [ pattern ]
pattern = "pattern" -&gt; string</code></pre>
                      </div>
                    </div>
                  </div>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">Resolves the Nested Diagnostic Context (NDC), aka. Thread Context
                    Stack,
                    <code>String[]</code> returned by <code>logEvent.getContextStack()</code></p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">none</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <div>
                    <div class="paragraph">
                      <p>Resolve all NDC values into a list:</p>
                    </div>
                    <div class="listingblock">
                      <div class="content">
                        <pre class="highlight"><code class="language-json" data-lang="json">{
  "$resolver": "ndc"
}</code></pre>
                      </div>
                    </div>
                    <div class="paragraph">
                      <p>Resolve all NDC values matching with the <code>pattern</code>                        regex:</p>
                    </div>
                    <div class="listingblock">
                      <div class="content">
                        <pre class="highlight"><code class="language-json" data-lang="json">{
  "$resolver": "ndc",
  "pattern": "user(Role|Rank):\\w+"
}</code></pre>
                      </div>
                    </div>
                  </div>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock"><code>source</code></p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <div>
                    <div class="listingblock">
                      <div class="content">
                        <pre class="highlight"><code>config = "field" -&gt; (
           "className"  |
           "fileName"   |
           "methodName" |
           "lineNumber" )</code></pre>
                      </div>
                    </div>
                  </div>
                </td>
                <td class="tableblock halign-left valign-top">
                  <div>
                    <div class="paragraph">
                      <p>Resolves the fields of the <code>StackTraceElement</code> returned
                        by
                        <code>logEvent.getSource()</code>.</p>
                    </div>
                    <div class="paragraph">
                      <p>Note that this resolver is toggled by
                        <code>log4j.layout.jsonTemplate.locationInfoEnabled</code>                        property.</p>
                    </div>
                  </div>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">none</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <div>
                    <div class="paragraph">
                      <p>Resolve the line number:</p>
                    </div>
                    <div class="listingblock">
                      <div class="content">
                        <pre class="highlight"><code class="language-json" data-lang="json">{
  "$resolver": "source",
  "field": "lineNumber"
}</code></pre>
                      </div>
                    </div>
                  </div>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock"><code>thread</code></p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <div>
                    <div class="listingblock">
                      <div class="content">
                        <pre class="highlight"><code>config = "field" -&gt; ( "name" | "id" | "priority" )</code></pre>
                      </div>
                    </div>
                  </div>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">resolves <code>logEvent.getThreadId()</code>, <code>logEvent.getThreadName()</code>,
                    <code>logEvent.getThreadPriority()</code></p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">none</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <div>
                    <div class="paragraph">
                      <p>Resolve the thread name:</p>
                    </div>
                    <div class="listingblock">
                      <div class="content">
                        <pre class="highlight"><code class="language-json" data-lang="json">{
  "$resolver": "thread",
  "field": "name"
}</code></pre>
                      </div>
                    </div>
                  </div>
                </td>
              </tr>
              <tr>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock"><code>timestamp</code></p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <div>
                    <div class="listingblock">
                      <div class="content">
                        <pre class="highlight"><code>config        = [ patternConfig | epochConfig ]

patternConfig = "pattern" -&gt; (
                  [ format ]   ,
                  [ timeZone ] ,
                  [ locale ]   )
format        = "format" -&gt; string
timeZone      = "timeZone" -&gt; string
locale        = "locale" -&gt; (
                   language                                   |
                 ( language , "_" , country )                 |
                 ( language , "_" , country , "_" , variant )
               )

epochConfig   = "epoch" -&gt; ( unit , [ rounded ] )
unit          = "unit" -&gt; (
                   "nanos"         |
                   "millis"        |
                   "secs"          |
                   "millis.nanos"  |
                   "secs.nanos"    |
                )
rounded       = "rounded" -&gt; boolean</code></pre>
                      </div>
                    </div>
                  </div>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">resolves <code>logEvent.getInstant()</code> in various forms</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <p class="tableblock">none</p>
                </td>
                <td class="tableblock halign-left valign-top">
                  <div>
                    <table class="tableblock frame-all grid-all spread">
                      <caption class="title">Table 3. <code>timestamp</code> template resolver examples</caption>
                      <colgroup>
                        <col style="width: 71.4285%;">
                        <col style="width: 28.5715%;">
                      </colgroup>
                      <tbody>
                        <tr>
                          <td class="tableblock halign-left valign-top">
                            <p class="tableblock">Configuration</p>
                          </td>
                          <td class="tableblock halign-left valign-top">
                            <p class="tableblock"><code>Output</code></p>
                          </td>
                        </tr>
                        <tr>
                          <td class="tableblock halign-left valign-top">
                            <div>
                              <div class="listingblock">
                                <div class="content">
                                  <pre class="highlight"><code class="language-json" data-lang="json">{
  "$resolver": "timestamp"
}</code></pre>
                                </div>
                              </div>
                            </div>
                          </td>
                          <td class="tableblock halign-left valign-top">
                            <p class="tableblock"><code>2020-02-07T13:38:47.098+02:00</code></p>
                          </td>
                        </tr>
                        <tr>
                          <td class="tableblock halign-left valign-top">
                            <div>
                              <div class="listingblock">
                                <div class="content">
                                  <pre class="highlight"><code class="language-json" data-lang="json">{
  "$resolver": "timestamp",
  "pattern": {
    "format": "yyyy-MM-dd'T'HH:mm:ss.SSS'Z'",
    "timeZone": "UTC",
    "locale": "en_US"
  }
}</code></pre>
                                </div>
                              </div>
                            </div>
                          </td>
                          <td class="tableblock halign-left valign-top">
                            <p class="tableblock"><code>2020-02-07T13:38:47.098Z</code></p>
                          </td>
                        </tr>
                        <tr>
                          <td class="tableblock halign-left valign-top">
                            <div>
                              <div class="listingblock">
                                <div class="content">
                                  <pre class="highlight"><code class="language-json" data-lang="json">{
  "$resolver": "timestamp",
  "epoch": {
    "unit": "secs"
  }
}</code></pre>
                                </div>
                              </div>
                            </div>
                          </td>
                          <td class="tableblock halign-left valign-top">
                            <p class="tableblock"><code>1581082727.982123456</code></p>
                          </td>
                        </tr>
                        <tr>
                          <td class="tableblock halign-left valign-top">
                            <div>
                              <div class="listingblock">
                                <div class="content">
                                  <pre class="highlight"><code class="language-json" data-lang="json">{
  "$resolver": "timestamp",
  "epoch": {
    "unit": "secs",
    "rounded": true
  }
}</code></pre>
                                </div>
                              </div>
                            </div>
                          </td>
                          <td class="tableblock halign-left valign-top">
                            <p class="tableblock"><code>1581082727</code></p>
                          </td>
                        </tr>
                        <tr>
                          <td class="tableblock halign-left valign-top">
                            <div>
                              <div class="listingblock">
                                <div class="content">
                                  <pre class="highlight"><code class="language-json" data-lang="json">{
  "$resolver": "timestamp",
  "epoch": {
    "unit": "secs.nanos"
  }
}</code></pre>
                                </div>
                              </div>
                            </div>
                          </td>
                          <td class="tableblock halign-left valign-top">
                            <p class="tableblock"><code>982123456</code></p>
                          </td>
                        </tr>
                        <tr>
                          <td class="tableblock halign-left valign-top">
                            <div>
                              <div class="listingblock">
                                <div class="content">
                                  <pre class="highlight"><code class="language-json" data-lang="json">{
  "$resolver": "timestamp",
  "epoch": {
    "unit": "millis"
  }
}</code></pre>
                                </div>
                              </div>
                            </div>
                          </td>
                          <td class="tableblock halign-left valign-top">
                            <p class="tableblock"><code>1581082727982.123456</code></p>
                          </td>
                        </tr>
                        <tr>
                          <td class="tableblock halign-left valign-top">
                            <div>
                              <div class="listingblock">
                                <div class="content">
                                  <pre class="highlight"><code class="language-json" data-lang="json">{
  "$resolver": "timestamp",
  "epoch": {
    "unit": "millis",
    "rounded": true
  }
}</code></pre>
                                </div>
                              </div>
                            </div>
                          </td>
                          <td class="tableblock halign-left valign-top">
                            <p class="tableblock"><code>1581082727982</code></p>
                          </td>
                        </tr>
                        <tr>
                          <td class="tableblock halign-left valign-top">
                            <div>
                              <div class="listingblock">
                                <div class="content">
                                  <pre class="highlight"><code class="language-json" data-lang="json">{
  "$resolver": "timestamp",
  "epoch": {
    "unit": "millis.nanos"
  }
}</code></pre>
                                </div>
                              </div>
                            </div>
                          </td>
                          <td class="tableblock halign-left valign-top">
                            <p class="tableblock"><code>123456</code></p>
                          </td>
                        </tr>
                        <tr>
                          <td class="tableblock halign-left valign-top">
                            <div>
                              <div class="listingblock">
                                <div class="content">
                                  <pre class="highlight"><code class="language-json" data-lang="json">{
  "$resolver": "timestamp",
  "epoch": {
    "unit": "nanos"
  }
}</code></pre>
                                </div>
                              </div>
                            </div>
                          </td>
                          <td class="tableblock halign-left valign-top">
                            <p class="tableblock"><code>1581082727982123456</code></p>
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
        <div class="sect2">
          <h3 id="stack-trace-element-templates">Stack Trace Element Templates</h3>
          <div class="paragraph">
            <p><code>stackTraceElement[Uri]</code> describes the JSON structure <code>JsonTemplateLayout</code>              uses to format <code>StackTraceElement</code>s. The default configuration
              (accessible by
              <code>log4j.layout.jsonTemplate.stackTraceElementTemplate[Uri]</code>              property) is set to
              <code>classpath:StackTraceElementLayout.json</code> provided by the
              <code>log4j-layout-json-template</code> artifact:</p>
          </div>
          <div class="listingblock">
            <div class="content">
              <pre class="highlight"><code class="language-json" data-lang="json">{
  "class": {
    "$resolver": "stackTraceElement",
    "field": "className"
  },
  "method": {
    "$resolver": "stackTraceElement",
    "field": "methodName"
  },
  "file": {
    "$resolver": "stackTraceElement",
    "field": "fileName"
  },
  "line": {
    "$resolver": "stackTraceElement",
    "field": "lineNumber"
  }
}</code></pre>
            </div>
          </div>
          <div class="paragraph">
            <p>The allowed template configuration syntax is as follows:</p>
          </div>
          <div class="listingblock">
            <div class="content">
              <pre class="highlight"><code>config = "field" -&gt; (
           "className"  |
           "fileName"   |
           "methodName" |
           "lineNumber" )</code></pre>
            </div>
          </div>
          <div class="paragraph">
            <p>All above accesses to <code>StackTraceElement</code> is garbage-free.</p>
          </div>
        </div>
      </div>
    </div>
    <div class="sect1">
      <h2 id="features">Features</h2>
      <div class="sectionbody">
        <div class="paragraph">
          <p>Below is a feature comparison matrix between <code>JsonTemplateLayout</code>            and alternatives.
          </p>
        </div>
        <table class="tableblock frame-all grid-all spread">
          <caption class="title">Table 3. Feature comparison matrix</caption>
          <colgroup>
            <col style="width: 42.8571%;">
            <col style="width: 14.2857%;">
            <col style="width: 14.2857%;">
            <col style="width: 14.2857%;">
            <col style="width: 14.2858%;">
          </colgroup>
          <tbody>
            <tr>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock">Feature</p>
              </td>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock"><code>JsonTemplateLayout</code></p>
              </td>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock"><a href="layouts.html#JSONLayout"><code>JsonLayout</code></a></p>
              </td>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock"><a href="layouts.html#GELFLayout"><code>GelfLayout</code></a></p>
              </td>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock"><a href="https://github.com/elastic/java-ecs-logging/tree/master/log4j2-ecs-layout"><code>EcsLayout</code></a></p>
              </td>
            </tr>
            <tr>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock">Java version</p>
              </td>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock">8</p>
              </td>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock">8</p>
              </td>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock">8</p>
              </td>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock">6</p>
              </td>
            </tr>
            <tr>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock">Dependencies</p>
              </td>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock">None</p>
              </td>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock">Jackson</p>
              </td>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock">None</p>
              </td>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock">None</p>
              </td>
            </tr>
            <tr>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock">Full schema customization?</p>
              </td>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock">✓</p>
              </td>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock">✕</p>
              </td>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock">✕</p>
              </td>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock">✕</p>
              </td>
            </tr>
            <tr>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock">Timestamp customization?</p>
              </td>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock">✓</p>
              </td>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock">✕</p>
              </td>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock">✕</p>
              </td>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock">✕</p>
              </td>
            </tr>
            <tr>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock">(Almost) garbage-free?</p>
              </td>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock">✓</p>
              </td>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock">✕</p>
              </td>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock">✓</p>
              </td>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock">✓</p>
              </td>
            </tr>
            <tr>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock">Custom typed <code>Message</code> serialization?</p>
              </td>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock">✓</p>
              </td>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock">✕</p>
              </td>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock">✕</p>
              </td>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock">?<sup class="footnote">[<a id="_footnoteref_1" class="footnote" href="#_footnote_1" title="View footnote.">1</a>]</sup></p>
              </td>
            </tr>
            <tr>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock">Custom typed <code>MDC</code> value serialization?</p>
              </td>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock">✓</p>
              </td>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock">✕</p>
              </td>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock">✕</p>
              </td>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock">✕</p>
              </td>
            </tr>
            <tr>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock">Rendering stack traces as array?</p>
              </td>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock">✓</p>
              </td>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock">✓</p>
              </td>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock">✕</p>
              </td>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock">✓</p>
              </td>
            </tr>
            <tr>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock">JSON pretty print?</p>
              </td>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock">✕</p>
              </td>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock">✓</p>
              </td>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock">✕</p>
              </td>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock">✕</p>
              </td>
            </tr>
            <tr>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock">Additional fields?</p>
              </td>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock">✓</p>
              </td>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock">✓</p>
              </td>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock">✓</p>
              </td>
              <td class="tableblock halign-left valign-top">
                <p class="tableblock">✓</p>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
    <div class="sect1">
      <h2 id="faq">F.A.Q.</h2>
      <div class="sectionbody">
        <div class="sect2">
          <h3 id="faq-lookups">Are lookups supported in templates?</h3>
          <div class="paragraph">
            <p>Yes, <a href="lookups.html">lookups</a> (e.g., <code>${java:version}</code>,
              <code>${env:USER}</code>,
              <code>${date:MM-dd-yyyy}</code>) are supported in string literals of
              templates. Though note that they are not garbage-free.</p>
          </div>
        </div>
        <div class="sect2">
          <h3 id="faq-garbage-free">Is <code>JsonTemplateLayout</code> garbage-free?</h3>
          <div class="paragraph">
            <p>Yes, if the garbage-free layout behaviour toggling properties
              <code>log4j2.enableDirectEncoders</code> and <code>log4j2.garbagefreeThreadContextMap</code>              are enabled. Take into account the following caveats:</p>
          </div>
          <div class="ulist">
            <ul>
              <li>
                <p>The configured <a href="#recycling-strategy">recycling strategy</a>                  might not be garbage-free.
                </p>
              </li>
              <li>
                <p>Since <code>Throwable#getStackTrace()</code> clones the original
                  <code>StackTraceElement[]</code>, access to (and hence rendering
                  of) stack traces are not garbage-free.</p>
              </li>
              <li>
                <p>Serialization of <code>MapMessage</code>s and <code>ObjectMessage</code>s
                  are mostly garbage-free except for certain types (e.g., <code>BigDecimal</code>,
                  <code>BigInteger</code>,
                  <code>Collection</code>s with the exception of <code>List</code>).</p>
              </li>
              <li>
                <p><a href="lookups.html">Lookups</a> (that is, <code>${&#8230;&#8203;}</code>                  variables, excluding
                  <code>${json:&#8230;&#8203;}</code> ones) are not garbage-free.</p>
              </li>
            </ul>
          </div>
          <div class="paragraph">
            <p>Don&#8217;t forget to checkout <a href="#event-template-resolvers">the notes on garbage footprint of resolvers</a>              you employ in templates.</p>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div id="footnotes">
    <hr>
    <div class="footnote" id="_footnote_1">
      <a href="#_footnoteref_1">1</a>. Only for <code>ObjectMessage</code>s and if
      Jackson is in the classpath.
    </div>
  </div>
</body>

</html>