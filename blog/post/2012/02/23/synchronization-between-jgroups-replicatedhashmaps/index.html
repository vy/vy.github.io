<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Synchronization Between JGroups.ReplicatedHashMap's</title>
    <link rel="stylesheet" href="/css/common.css">
    <meta name="generator" content="nanoc 3.8.0">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/css/post.css">
    <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-40183531-1']);
      _gaq.push(['_trackPageview']);
      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
  </head>
  <body>
    <div id="container">

      <ul id="menu">
        <li><a href="/">Home</a></li><li><a href="/blog/">Blog</a></li><li><a href="/code/">Code</a></li><li><a href="/blog/feed/">Feed</a></li>
      </ul>

    

<div id="post">

    <div class="head">
        <div class="title">Synchronization Between JGroups.ReplicatedHashMap's</div>
        <div class="subtitle">posted on
            2012-02-23
            with tags <a href="/blog/tag/java">java</a>, <a href="/blog/tag/jgroups">jgroups</a>
        </div>
    </div>

    <div class="body">

        <script type="text/javascript">
        var asyncLoadRequests = [];
        </script>

        
<p><a href="http://www.jgroups.org/javadoc/org/jgroups/blocks/ReplicatedHashMap.html"><code>ReplicatedHashMap</code></a> of <a href="http://www.jgroups.org/">JGroups</a> provides a distributed <a href="http://docs.oracle.com/javase/6/docs/api/java/util/concurrent/ConcurrentHashMap.html"><code>ConcurrentHashMap</code></a> implementation. In its simplest form, it propagates every local change to all other instances in the cluster and you get your replicated-HashMap between available cluster members.</p>

<p>In a cluster environment, new node arrivals are highly anticipated, but <code>ReplicatedHashMap</code> doesn’t really keep up with the late joiners. See below execution flow for a late joiner scenario.</p>

<table>
  <thead>
    <tr>
      <th style="text-align: center">Time</th>
      <th>Node A</th>
      <th>Node B</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center">1</td>
      <td>join</td>
      <td> </td>
    </tr>
    <tr>
      <td style="text-align: center">2</td>
      <td>send 1</td>
      <td> </td>
    </tr>
    <tr>
      <td style="text-align: center">3</td>
      <td>recv 1</td>
      <td> </td>
    </tr>
    <tr>
      <td style="text-align: center">4</td>
      <td>observe {1}</td>
      <td> </td>
    </tr>
    <tr>
      <td style="text-align: center">5</td>
      <td> </td>
      <td>join</td>
    </tr>
    <tr>
      <td style="text-align: center">6</td>
      <td> </td>
      <td>observe {}</td>
    </tr>
    <tr>
      <td style="text-align: center">7</td>
      <td> </td>
      <td>send 2</td>
    </tr>
    <tr>
      <td style="text-align: center">8</td>
      <td>recv 2</td>
      <td>recv 2</td>
    </tr>
    <tr>
      <td style="text-align: center">9</td>
      <td>observe {1,2}</td>
      <td>observe {2}</td>
    </tr>
  </tbody>
</table>

<p>In the above figure, nodes are out of sync at time steps 6 and 9. To avoid such cases, we need to force <code>ReplicatedHashMap</code> for a sync during initialization. For this purpose, quoting with Bela Ban’s (author of JGroups) words,</p>

<ol>
  <li>Move <code>JChannel.connect()</code> after the creation of <code>ReplicatedHashMap</code>,</li>
  <li>I also suggest to call <code>ReplicatedHashmap.start()</code>, or else there won’t be any state transfer.</li>
</ol>

<p>See <a href="http://comments.gmane.org/gmane.comp.java.javagroups.general/7665">ReplicatedHashMap Updates for Late Joiners</a> post in the mailing-list for the related discussion.</p>


        

        

    </div>
  </body>
</html>


        <script type="text/javascript">
        for (var i = 0; i < asyncLoadRequests.length; i++) {
            asyncLoadRequest = asyncLoadRequests[i];
            asyncLoadRequest();
        }
        </script>

    </div>

</div>
